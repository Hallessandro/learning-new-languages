<!doctype html>
<html>

<head>  
  <title>
    
      #10 - Criação e integração de um bot ao RocketChat | Hallessandro' Adventures
    
  </title>
    
    <meta property="og:image" content="/assets/img/coverPosts/rocket_hubot.png" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">
  <!-- Use Atom -->
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Hallessandro' Adventures" />
  <!-- Use RSS-2.0 -->
  <!--<link href="/rss-feed.xml" type="application/rss+xml" rel="alternate" title="Hallessandro' Adventures | Developed with Jekyll and Github Pages"/>
  //-->

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Quattrocento+Sans">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <script type="text/javascript" async
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>

  <!-- Google Analytics -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-112060364-1', 'auto');
  ga('send', 'pageview');
</script>


  <!-- Use Jekyll SEO plugin -->
  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>#10 - Criação e integração de um bot ao RocketChat | Hallessandro’ Adventures</title>
<meta name="generator" content="Jekyll v3.6.3" />
<meta property="og:title" content="#10 - Criação e integração de um bot ao RocketChat" />
<meta name="author" content="Hallessandro D´villa" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Olá terráqueos, no post de hoje vamos ver como criar um bot utilizando o Hubot, um robô customizável e open source, criado e distribuído pelo GitHub." />
<meta property="og:description" content="Olá terráqueos, no post de hoje vamos ver como criar um bot utilizando o Hubot, um robô customizável e open source, criado e distribuído pelo GitHub." />
<link rel="canonical" href="http://localhost:4000/programming/criando-bot-com-hubot.html" />
<meta property="og:url" content="http://localhost:4000/programming/criando-bot-com-hubot.html" />
<meta property="og:site_name" content="Hallessandro’ Adventures" />
<meta property="og:image" content="http://localhost:4000/coverPosts/rocket_hubot.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-11-18T00:00:00-03:00" />
<script type="application/ld+json">
{"headline":"#10 - Criação e integração de um bot ao RocketChat","dateModified":"2018-11-18T00:00:00-03:00","datePublished":"2018-11-18T00:00:00-03:00","@type":"BlogPosting","image":"http://localhost:4000/coverPosts/rocket_hubot.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/programming/criando-bot-com-hubot.html"},"url":"http://localhost:4000/programming/criando-bot-com-hubot.html","author":{"@type":"Person","name":"Hallessandro D´villa"},"description":"Olá terráqueos, no post de hoje vamos ver como criar um bot utilizando o Hubot, um robô customizável e open source, criado e distribuído pelo GitHub.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


</head>


<body>

  <div class="container">
    <header class="masthead">
  <h3 class="masthead-title">
    <a href="/">Hallessandro' Adventures</a>
    <!-- <small class="masthead-subtitle">Developed with Jekyll and Github Pages</small>-->
    <div class="menu">
  <nav class="menu-content">
    
      <a href="/menu/about.html">About</a>
    
      <a href="/menu/writing.html">Posts</a>
    
      <a href="/menu/contact.html">Contact</a>
    
  </nav>
  <nav class="social-icons">
    
  
  
    <a href="https://github.com/Hallessandro" target="_blank"><i class="fa fa-github" aria-hidden="true"></i></a>
  

  
  
    <a href="https://twitter.com/_MrDvilla" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
  

  
  
    <a href="https://www.linkedin.com/in/hallessandro/" target="_blank"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
  

  
  
    <a href="https://www.facebook.com/hallessandro.dvilla" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a>
  

  
  
    <a href="mailto:hd.jesus93@gmail.com" target="_blank"><i class="fa fa-envelope" aria-hidden="true"></i></a>
  

  
  
    <a href="/feed.xml"><i class="fa fa-rss-square" aria-hidden="true"></i></a>
  

  </nav>
</div>

  </h3>
</header>


    <div class="post-container">
      <h1>
  #10 - Criação e integração de um bot ao RocketChat
</h1>


  <img src="/assets/img/coverPosts/rocket_hubot.png">


<p>Olá terráqueos, no post de hoje vamos ver como criar um bot utilizando o Hubot, um robô customizável e open source, criado e distribuído pelo GitHub.</p>

<p>Antes de começar é necessário que você tenha o Node e o NPM instalados em sua máquina, para verificar, abra o terminal e digite os seguintes comandos:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nt">--version</span>
node <span class="nt">--version</span>
</code></pre></div></div>

<p>Caso precise instalar um dos dois, você pode dar uma olhada em como fazer isso nesse tutorial da <a href="https://www.digitalocean.com/community/tutorials/como-instalar-o-node-js-no-ubuntu-16-04-pt">Digital Ocean</a>.</p>

<p>Além do Node e NPM, também vamos instalar o Hubot e o Redis. O Redis é necessário pois é utilizado pelo Hubot para salvar dados.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install <span class="nt">-g</span> yo generator-hubot
<span class="nb">sudo </span>apt update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt install redis-server
</code></pre></div></div>

<p>Com tudo devidamente instalado, crie uma pasta no diretório que desejar e acesse a pasta pelo terminal, dentro da pasta digite o comando abaixo:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yo hubot
</code></pre></div></div>

<p>Serão feitas algumas perguntas a você, como o nome do bot e o adapter a ser utilizado. Sobre os adapters eis o que fala a documentação do Hubot:</p>

<blockquote>
  <p>“Adapters are the interface to the service you want your hubot to run on.”</p>
</blockquote>

<p>No nosso caso vamos integrar o Hubot ao RocketChat, por isso quando questionado pelo adapter, responda “rocketchat”. Para as demais perguntas fique a vontade para responder da forma como quiser, além do adapter a única outra que fará grande diferença é o nome do bot, pois é por esse nome que ele será chamado.</p>

<p><img src="../assets/img/post_hubot/01.png" alt="first-test" /></p>

<p>Para testar o bot recém criado, pelo terminal, acesse a pasta onde ele foi criado, e então digite o comando ./bin/hubot. Uma característica do Hubot, é que quando criado, ele não faz muita coisa, porém você checar o que ele é capaz de fazer por meio do comando abaixo:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nome_do_bot <span class="nb">help</span>
</code></pre></div></div>

<p>Uma lista de comandos será apresentada, escolha um deles e execute para testar.</p>

<p><img src="../assets/img/post_hubot/02.png" alt="first-test" /></p>

<p>Apesar de não fazer grandes coisas logo após sua criação, o Hubot é extremamente moldável, o que permite que possa ser expandido para fazer as mais diversas funções. Como exemplo, dentro do GitHub ele é responsável por atuar como um agente ativo no processo de deploy do GitHub, como você pode ver nesse vídeo <a href="https://www.youtube.com/watch?v=kCGeB3ewHyA">aqui</a>.</p>

<p>Esse processo onde um bot é integrado a um canal de comunicação, participando ativamente dos processos da empresa, recebe o nome de ChatOps, porém não vamos entrar muito em detalhes disto agora, pois seria um spoiler de outro post. :-D</p>

<p>Abra a pasta onde o bot foi criado no seu editor de código preferido e vamos brincar um pouco com ele.</p>

<p>Dentro da pasta, veja que existe uma subpasta chamada scripts, dentro dessa pasta é onde serão armazenados todos os scripts criados para aprimorar o seu bot. No Hubot são suportados dois tipos de arquivo, os .js e os .coffee.</p>

<p>Para que um arquivo esteja dentro dos padrões do Hubot, basta que o mesmo  esteja dentro da pasta de scripts, que seja de um dos dois formatos supracitados e que exporte uma função, algo como:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="nx">robot</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="err">\\</span><span class="nx">your</span> <span class="nx">code</span> <span class="nx">here</span>
</code></pre></div></div>

<p>O parâmetro robot é uma instância do seu bot, ele sempre deve ser passado nas funções criadas.</p>

<p>O nosso bot criado com Hubot, nada mais é do que um chatbot, e como um, as duas interações mais simples que ele deve ser capaz de realizar são ouvir e responder, para isso o Hubot disponibiliza os métodos hear e respond. Uma caracteristica de ambos os métodos é que eles recebem como parâmetros uma expressão regular e uma função de callback, como no exemplo abaixo, tirado diretamente da documentação oficial:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="nx">robot</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">robot</span><span class="p">.</span><span class="nx">hear</span> <span class="o">/</span><span class="nx">badger</span><span class="o">/</span><span class="nx">i</span><span class="p">,</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">\\</span><span class="nx">your</span> <span class="nx">code</span> <span class="nx">here</span>

  <span class="nx">robot</span><span class="p">.</span><span class="nx">respond</span> <span class="o">/</span><span class="nx">open</span> <span class="nx">the</span> <span class="nx">pod</span> <span class="nx">bay</span> <span class="nx">doors</span><span class="o">/</span><span class="nx">i</span><span class="p">,</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="o">-&gt;</span>
	<span class="err">\\</span><span class="nx">your</span> <span class="nx">code</span> <span class="nx">here</span>
</code></pre></div></div>

<p>O método <strong>robot.hear</strong> é acionado sempre que uma mensagem de texto combinar com o padrão, como nos exemplos abaixo:</p>

<ol>
  <li>Stop badgering the witness</li>
  <li>badger me</li>
  <li>what exactly is a badger anyways</li>
</ol>

<p>Já o método <strong>robot.respond</strong> é chamado por mensagens que combinem com o padrão passado como parâmetro e sejam precedidas pelo nome ou alias do bot. Supondo que o nome do bot é HAL e o alias /, o método em questão retornaria algo, para os seguintes exemplos:</p>

<ol>
  <li>hal open the pod bay doors</li>
  <li>HAL: open the pod bay doors</li>
  <li>@HAL open the pod bay doors</li>
  <li>/open the pod bay doors</li>
</ol>

<p>A documentação completa sobre o que é possível fazer com scripts no Hubot, pode ser vista <a href="https://hubot.github.com/docs/scripting/">aqui</a>.</p>

<p>Neste post vamos focar na capacidade de fazer requisições HTTP, para consumir uma API que retorne informações sobre a cotação atual de algumas moedas.</p>

<p>O Hubot é capaz de trabalhar com requisições HTTP por meio do robot.http, que nada mais do que uma instância node-scoped-http-client. Um simples exemplo é:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">robot</span><span class="p">.</span><span class="nx">http</span><span class="p">(</span><span class="s2">"https://midnight-train"</span><span class="p">)</span>
    <span class="p">.</span><span class="kd">get</span><span class="p">()</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="err">\#</span> <span class="nx">your</span> <span class="nx">code</span> <span class="nx">here</span>
</code></pre></div></div>

<p>Antes de começar a implementar o código para consumo da API de cotação de modeas, vamos configurar o RocketChat, para isso você vai precisar do Docker, caso não tenha instalado, dê uma olhada nesse tutorial <a href="https://www.digitalocean.com/community/tutorials/como-instalar-e-usar-o-docker-no-ubuntu-16-04-pt">aqui</a> da DigitalOcean.</p>

<p>Para instalar o RocketChat você vai precisar executar dois comandos, um para obter a imagem do MongoDB, utilizado pelo RocketChat e outro para obter a imagem do próprio chat, ambos seguem listados abaixo:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker run <span class="nt">--name</span> db <span class="nt">-d</span> mongo:3.0 <span class="nt">--smallfiles</span>
<span class="nb">sudo </span>docker run <span class="nt">--name</span> rocketchat <span class="nt">-p</span> 80:3000 <span class="nt">--env</span> <span class="nv">ROOT_URL</span><span class="o">=</span>http://localhost <span class="nt">--link</span> db <span class="nt">-d</span> rocket.chat
</code></pre></div></div>

<p>Depois que tudo for finalizado, acesse o localhost/ para ter acesso a sua instância do RocketChat. Antes de começar a utilizar o chat, você vai precisar realizar algumas configurações, nada demais, basta seguir o que é mostrado nas quatro telas abaixo:</p>

<p><img src="../assets/img/post_hubot/03.png" alt="first-test" /></p>

<p><img src="../assets/img/post_hubot/04.png" alt="first-test" /></p>

<p><img src="../assets/img/post_hubot/05.png" alt="first-test" /></p>

<p><img src="../assets/img/post_hubot/06.png" alt="first-test" /></p>

<p>Com o RocketChat devidamente configurado vamos criar um usuário para o nosso bot, ele vai precisar para conseguir acessar o chat, para isso acesse o menu de Administração:</p>

<p><img src="../assets/img/post_hubot/07.png" alt="first-test" /></p>

<p>Acesse a parte de usuários, clique no + e preencha o cadastro conforme na imagem abaixo:</p>

<p><img src="../assets/img/post_hubot/08.png" alt="first-test" /></p>

<p>É importante que o papel seja o de bot e que não seja exigido troca de senha do nosso bot.</p>

<p>Agora vamos fazer com o bot seja capaz de se conectar ao RocketChat, para isso crie o arquivo .env na raíz do projeto com o seguinte conteúdo:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="nx">ROCKETCHAT_URL</span><span class="o">=</span><span class="nx">localhost</span><span class="p">:</span><span class="mi">80</span> <span class="err">#</span><span class="nx">Caminho</span> <span class="nx">e</span> <span class="nx">porta</span> <span class="nx">da</span> <span class="nx">nossa</span> <span class="nx">inst</span><span class="err">â</span><span class="nx">ncia</span> <span class="k">do</span> <span class="nx">RocketChat</span>
<span class="k">export</span> <span class="nx">ROCKETCHAT_USER</span><span class="o">=</span><span class="nx">hubot</span> <span class="err">#</span><span class="nx">Usuario</span> <span class="nx">de</span> <span class="nx">acesso</span> <span class="nx">ao</span> <span class="nx">rocketchat</span>
<span class="k">export</span> <span class="nx">ROCKETCHAT_PASSWORD</span><span class="o">=</span><span class="nx">esighallessandro93</span> <span class="err">#</span><span class="nx">Senha</span> <span class="nx">de</span> <span class="nx">acesso</span> <span class="nx">ao</span> <span class="nx">rocketchat</span>
<span class="k">export</span> <span class="nx">ROCKETCHAT_ROOM</span><span class="o">=</span><span class="nx">general</span>
<span class="k">export</span> <span class="nx">ROCKETCHAT_USE_SSL</span><span class="o">=</span><span class="kc">false</span>
<span class="k">export</span> <span class="nx">ROCKETCHAT_ROOM</span><span class="o">=</span><span class="s1">''</span>
<span class="k">export</span> <span class="nx">LISTEN_ON_ALL_PUBLIC</span><span class="o">=</span><span class="kc">true</span> <span class="err">#</span><span class="nx">Informa</span> <span class="nx">que</span> <span class="nx">o</span> <span class="nx">bot</span> <span class="nx">tem</span> <span class="nx">acesso</span> <span class="nx">a</span> <span class="nx">todos</span> <span class="nx">os</span> <span class="nx">canais</span> <span class="nx">p</span><span class="err">ú</span><span class="nx">blicos</span>
</code></pre></div></div>

<p>Agora abra o arquivo hubot que fica dentro de bin, e na linha exec adicione -a “rocketchat” logo depois do –name.</p>

<p><img src="../assets/img/post_hubot/09.png" alt="first-test" /></p>

<p>No terminal execute o comando source .env e então ./bin/hubot, ao fazer isso volte ao RocketChat e veja que o usuário do seu bot está online. Mande uma mensagem para ele no canal General que já está criado, algo como dolarbot help ou ping.</p>

<p><img src="../assets/img/post_hubot/10.png" alt="first-test" /></p>

<p>Agora vamos implementar o script para consumo da api de moedas, por meio da criação do arquivo cotacao.js na pasta de scripts. Um ponto importante sobre a criação de scripts é que eles podem ser facilmente documentados por meio de comentários no topo dos arquivos. Lembra do comando hubot help? Quando ele é executado o hubot vai ler os seus comentários para verificar quais comandos estão disponíveis e retornar na chamada do help.</p>

<p>O padrão de comentários do Hubot é o seguinte:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Description:</span>
<span class="c1">//   &lt;description of the scripts functionality&gt;</span>
<span class="c1">//</span>
<span class="c1">// Dependencies:</span>
<span class="c1">//   "&lt;module name&gt;": "&lt;module version&gt;"</span>
<span class="c1">//</span>
<span class="c1">// Configuration:</span>
<span class="c1">//   LIST_OF_ENV_VARS_TO_SET</span>
<span class="c1">//</span>
<span class="c1">// Commands:</span>
<span class="c1">//   hubot &lt;trigger&gt; - &lt;what the respond trigger does&gt;</span>
<span class="c1">//   &lt;trigger&gt; - &lt;what the hear trigger does&gt;</span>
<span class="c1">//</span>
<span class="c1">// Notes:</span>
<span class="c1">//   &lt;optional notes required for the script&gt;</span>
<span class="c1">//</span>
<span class="c1">// Author:</span>
<span class="c1">//   &lt;github username of the original script author&gt;</span>
</code></pre></div></div>

<p>Desses o Commands é o mais importante e o que é processado em tempo de execução para verificar quais comandos estão disponíveis.</p>

<p>Vamos começar nossa implementação criando um método para listar todas as moedas disponíveis para consulta, para isso você pode fazer algo como:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nx">robot</span><span class="p">.</span><span class="nx">respond</span><span class="p">(</span><span class="sr">/moedas dispon</span><span class="se">(</span><span class="sr">i|í</span><span class="se">)</span><span class="sr">veis/</span><span class="p">,</span> <span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s2">` segue a lista: 
            USD-BRL (Dólar Comercial)
            USD-BRLT (Dólar Turismo)
            CAD-BRL (Dólar Canadense)   
            EUR-BRL (Euro)
            GBP-BRL (Libra Esterlina)
            ARS-BRL (Peso Argentino)
            BTC-BRL (Bitcoin)
        `</span><span class="p">)</span>
    <span class="p">})</span>
</code></pre></div></div>

<p>Agora reinicie o hubot e volte ao RocketChat para testar o novo comando disponível.</p>

<p><img src="../assets/img/post_hubot/11.png" alt="first-test" /></p>

<p>Agora vamos criar o método para consumo da api de moedas, o endereço da api que vamos utilizar é o seguinte:</p>

<p>http://economia.awesomeapi.com.br/json/${moeda}/1</p>

<p>A documentação oficial da API pode ser encontrada <a href="https://docs.awesomeapi.com.br/api-de-moedas">aqui</a>.</p>

<p>Primeiro crie o robot.respond com a expressão regular que deseje que acione o método, depois na função de callback, será feito a requisição HTTP por meio de robot.http(URL).get(). O .get() vai ser responsável por tratar algum erro que venha a ocorrer e responder o usuário com o valor de compra da moeda.</p>

<p>O código final do método fica da seguinte forma:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nx">robot</span><span class="p">.</span><span class="nx">respond</span><span class="p">(</span><span class="sr">/cota</span><span class="se">(</span><span class="sr">c|ç</span><span class="se">)(</span><span class="sr">a|ã</span><span class="se">)</span><span class="sr">o do </span><span class="se">(</span><span class="sr">.*</span><span class="se">)</span><span class="sr">/</span><span class="p">,</span> <span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">moeda</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">match</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span> 
        <span class="nx">robot</span><span class="p">.</span><span class="nx">http</span><span class="p">(</span><span class="s2">`http://economia.awesomeapi.com.br/json/</span><span class="p">${</span><span class="nx">moeda</span><span class="p">}</span><span class="s2">/1`</span><span class="p">)</span>
            <span class="p">.</span><span class="kd">get</span><span class="p">()</span> <span class="p">((</span><span class="nx">err</span><span class="p">,</span> <span class="nx">resp</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">res</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s2">"houve um erro na comunicação com API, tente de novo!"</span><span class="p">)</span>

                <span class="kd">let</span> <span class="nx">resultado</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
                <span class="nx">res</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s2">`R$ </span><span class="p">${</span><span class="nx">resultado</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">bid</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
            <span class="p">})</span>
    <span class="p">});</span>
</code></pre></div></div>

<p>Repare que para capturar qual a moeda informada foi feito um res.match[3], o três aqui é a posição do valor da moeda. O valor da posição zero é a mensagem inteira, já na posição um temos o resultado do primeiro parênteses, que testa em c e ç, já na posição dois, o valor é o do segundo parênteses.</p>

<p>Em res.reply estamos retornando o valor da posição zero de resultado, pois o JSON que veio no body é um array que pode ter mais de um valor. A quantidade é definida pelo parâmetro 1 no final da URL, quanto maior o número, mais cotações serão recuperadas, como só temos uma podemos tranquilamente pegar apenas o valor da posição zero.</p>

<p>Com tudo feito, reinicie o seu bot e acesse o chat, requisitando a ele a cotação de alguma moeda, se tudo deu certo, você vai receber o resultado esperado, como na imagem abaixo:</p>

<p><img src="../assets/img/post_hubot/12.png" alt="first-test" /></p>

<p>O código fonte do bot criado durante esse post pode ser encontrado no meu GitHub, no repositório <a href="https://github.com/Hallessandro/dolarBot">dolarBot</a>.</p>

<p>Por hoje é tudo pessoal, porém esse é um assunto com bastante potencial e em breve voltarei com mais coisas relacionadas, então até a próxima.</p>

<p><img src="../assets/img/post_hubot/13.jpg" alt="first-test" /></p>


<span class="post-date">
  Written on
  
  November
  18th,
  2018
  by
  
    Hallessandro D´villa
  
</span>

<div class="post-date">Feel free to share!</div>
  <div class="sharing-icons">
    <a href="https://twitter.com/intent/tweet?text=#10 - Criação e integração de um bot ao RocketChat&amp;url=/programming/criando-bot-com-hubot.html" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
    <a href="https://www.facebook.com/sharer/sharer.php?u=/programming/criando-bot-com-hubot.html&amp;title=#10 - Criação e integração de um bot ao RocketChat" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a>
    <a href="https://plus.google.com/share?url=/programming/criando-bot-com-hubot.html" target="_blank"><i class="fa fa-google-plus" aria-hidden="true"></i></a>
  </div>
</div>


<div class="related">
  <h1 >You may also enjoy:</h1>
  
  <ul class="related-posts">
    
      
        
        
      
        
          <li>
            <h3>
              <a href="/programming/how-to-build-a-chatbot-with-dialogflow.html">
                #9 - How to build a Chatbot with DialogFlow
                <!--<img src="http://localhost:4000/images/">-->
                <!--<small>October 14, 2018</small>-->
              </a>
            </h3>
          </li>
          
        
      
    
      
        
        
      
    
      
        
        
      
    
  </ul>
</div>




    </div>

    <footer class="footer">
  
  
  
    <a href="https://github.com/Hallessandro" target="_blank"><i class="fa fa-github" aria-hidden="true"></i></a>
  

  
  
    <a href="https://twitter.com/_MrDvilla" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
  

  
  
    <a href="https://www.linkedin.com/in/hallessandro/" target="_blank"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
  

  
  
    <a href="https://www.facebook.com/hallessandro.dvilla" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a>
  

  
  
    <a href="mailto:hd.jesus93@gmail.com" target="_blank"><i class="fa fa-envelope" aria-hidden="true"></i></a>
  

  
  
    <a href="/feed.xml"><i class="fa fa-rss-square" aria-hidden="true"></i></a>
  

  <div class="post-date"><a href="/menu/about.html">Developed with Jekyll and Github Pages by Hallessandro D´villa</a></div>
</footer>

  </div>

</body>
</html>
